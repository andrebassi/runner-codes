---
title: 'HTTP API'
description: 'REST API for managing Firecracker microVMs programmatically'
---

## Overview

The `infra.operator api` command starts an HTTP server that provides a REST API for all operations. This allows programmatic access to rootfs management, snapshot operations, and code execution.

## Starting the Server

```bash
# Default: listen on 0.0.0.0:8080
infra.operator api

# Custom port
infra.operator api --port 3000

# Custom host and port
infra.operator api --host 127.0.0.1 --port 8080
```

**Output:**

```
Starting API server on 0.0.0.0:8080...

Endpoints:
  GET  /health
  GET  /api/v1/languages
  GET  /api/v1/rootfs
  POST /api/v1/rootfs
  GET  /api/v1/snapshots
  POST /api/v1/snapshots
  POST /api/v1/execute
```

## API Endpoints Overview

<Frame>
  <img src="/images/http-api-endpoints.svg" alt="HTTP API Endpoints" />
</Frame>

## API Reference

### Health Check

Check if the server is healthy.

<CodeGroup>
```bash cURL
curl http://localhost:8080/health
```

```python Python
import requests
response = requests.get("http://localhost:8080/health")
print(response.json())
```

```javascript JavaScript
fetch("http://localhost:8080/health")
  .then(res => res.json())
  .then(console.log)
```
</CodeGroup>

**Response:**

```json
{
  "status": "healthy",
  "version": "0.1.0"
}
```

---

### List Languages

Get all supported programming languages.

<CodeGroup>
```bash cURL
curl http://localhost:8080/api/v1/languages
```

```python Python
response = requests.get("http://localhost:8080/api/v1/languages")
languages = response.json()["languages"]
```
</CodeGroup>

**Response:**

```json
{
  "languages": [
    {
      "name": "python",
      "size_mb": 500,
      "extension": ".py",
      "runCommand": "python3 {file}"
    },
    {
      "name": "nodejs",
      "size_mb": 800,
      "extension": ".js",
      "runCommand": "node {file}"
    }
  ],
  "count": 45
}
```

---

### Get Language Details

Get details for a specific language.

<CodeGroup>
```bash cURL
curl http://localhost:8080/api/v1/languages/python
```

```python Python
response = requests.get("http://localhost:8080/api/v1/languages/python")
```
</CodeGroup>

**Response:**

```json
{
  "name": "python",
  "size_mb": 500,
  "packages": "python3 python3-pip",
  "postInstall": "",
  "extension": ".py",
  "runCommand": "python3 {file}"
}
```

---

### List Rootfs Images

List available rootfs images.

<CodeGroup>
```bash cURL
# List local images
curl http://localhost:8080/api/v1/rootfs

# List S3 images
curl http://localhost:8080/api/v1/rootfs?remote=true
```

```python Python
# Local
response = requests.get("http://localhost:8080/api/v1/rootfs")

# S3
response = requests.get("http://localhost:8080/api/v1/rootfs?remote=true")
```
</CodeGroup>

**Response (local):**

```json
{
  "rootfs": [
    {
      "language": "python",
      "path": "/srv/firecracker/images/rootfs-python.ext4",
      "size": 1288490188
    }
  ],
  "source": "local"
}
```

**Response (S3):**

```json
{
  "rootfs": [
    {
      "key": "rootfs-python.ext4",
      "size": 1288490188,
      "lastModified": "2025-11-29T10:30:00Z"
    }
  ],
  "source": "s3"
}
```

---

### Create Rootfs

Create a new rootfs image (async operation).

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/rootfs \
  -H "Content-Type: application/json" \
  -d '{"language": "python", "size_mb": 1024}'
```

```python Python
response = requests.post(
    "http://localhost:8080/api/v1/rootfs",
    json={"language": "python", "size_mb": 1024}
)
```
</CodeGroup>

**Request Body:**

```json
{
  "language": "python",
  "size_mb": 1024
}
```

**Response (202 Accepted):**

```json
{
  "message": "rootfs creation started",
  "language": "python"
}
```

---

### Upload Rootfs to S3

Upload a local rootfs image to S3.

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/rootfs/python/upload
```

```python Python
response = requests.post("http://localhost:8080/api/v1/rootfs/python/upload")
```
</CodeGroup>

**Response:**

```json
{
  "message": "rootfs uploaded",
  "s3_path": "s3://llm-infra-operator-rootfs/rootfs-python.ext4"
}
```

---

### Download Rootfs from S3

Download a rootfs image from S3.

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/rootfs/python/download
```

```python Python
response = requests.post("http://localhost:8080/api/v1/rootfs/python/download")
```
</CodeGroup>

**Response:**

```json
{
  "message": "rootfs downloaded",
  "local_path": "/srv/firecracker/images/rootfs-python.ext4"
}
```

---

### List Snapshots

List available snapshots.

<CodeGroup>
```bash cURL
# List local snapshots
curl http://localhost:8080/api/v1/snapshots

# List S3 snapshots
curl http://localhost:8080/api/v1/snapshots?remote=true
```

```python Python
# Local
response = requests.get("http://localhost:8080/api/v1/snapshots")

# S3
response = requests.get("http://localhost:8080/api/v1/snapshots?remote=true")
```
</CodeGroup>

**Response (local):**

```json
{
  "snapshots": [
    {
      "language": "python",
      "path": "/srv/firecracker/snapshots/python/",
      "vmstate_size": 2205696,
      "mem_size": 536870912
    }
  ],
  "source": "local"
}
```

---

### Create Snapshot

Create a new snapshot (async operation).

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/snapshots \
  -H "Content-Type: application/json" \
  -d '{"language": "python", "mem_mb": 512, "vcpus": 1}'
```

```python Python
response = requests.post(
    "http://localhost:8080/api/v1/snapshots",
    json={"language": "python", "mem_mb": 512, "vcpus": 1}
)
```
</CodeGroup>

**Request Body:**

```json
{
  "language": "python",
  "mem_mb": 512,
  "vcpus": 1
}
```

**Response (202 Accepted):**

```json
{
  "message": "snapshot creation started",
  "language": "python"
}
```

---

### Upload Snapshot to S3

Upload a local snapshot to S3.

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/snapshots/python/upload
```

```python Python
response = requests.post("http://localhost:8080/api/v1/snapshots/python/upload")
```
</CodeGroup>

**Response:**

```json
{
  "message": "snapshot uploaded",
  "s3_path": "s3://llm-infra-operator-rootfs/snapshots/python/"
}
```

---

### Download Snapshot from S3

Download a snapshot from S3.

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/snapshots/python/download
```

```python Python
response = requests.post("http://localhost:8080/api/v1/snapshots/python/download")
```
</CodeGroup>

**Response:**

```json
{
  "message": "snapshot downloaded",
  "local_path": "/srv/firecracker/snapshots/python/",
  "download_time": "2.456s"
}
```

---

### Execute Code

Execute code in a microVM.

<CodeGroup>
```bash cURL
curl -X POST http://localhost:8080/api/v1/execute \
  -H "Content-Type: application/json" \
  -d '{
    "language": "python",
    "code": "print(\"Hello from Firecracker!\")",
    "timeout": 30
  }'
```

```python Python
response = requests.post(
    "http://localhost:8080/api/v1/execute",
    json={
        "language": "python",
        "code": "print('Hello from Firecracker!')",
        "timeout": 30
    }
)
print(response.json())
```

```javascript JavaScript
const response = await fetch("http://localhost:8080/api/v1/execute", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    language: "python",
    code: "print('Hello from Firecracker!')",
    timeout: 30
  })
});
const result = await response.json();
console.log(result);
```
</CodeGroup>

**Request Body:**

```json
{
  "language": "python",
  "code": "print('Hello from Firecracker!')",
  "timeout": 30
}
```

**Response:**

```json
{
  "stdout": "Hello from Firecracker!\n",
  "stderr": "",
  "exit_code": 0,
  "load_time": "209ms",
  "exec_time": "45ms"
}
```

## Error Responses

All errors return a JSON object with an `error` field:

```json
{
  "error": "unknown language"
}
```

### HTTP Status Codes

| Status | Description |
|--------|-------------|
| 200 | Success |
| 202 | Accepted (async operation started) |
| 400 | Bad Request (invalid input) |
| 404 | Not Found (resource doesn't exist) |
| 500 | Internal Server Error |

## Python SDK Example

```python
import requests

class FirecrackerClient:
    def __init__(self, base_url="http://localhost:8080"):
        self.base_url = base_url

    def health(self):
        return requests.get(f"{self.base_url}/health").json()

    def list_languages(self):
        return requests.get(f"{self.base_url}/api/v1/languages").json()

    def execute(self, language, code, timeout=30):
        return requests.post(
            f"{self.base_url}/api/v1/execute",
            json={"language": language, "code": code, "timeout": timeout}
        ).json()

    def download_snapshot(self, language):
        return requests.post(
            f"{self.base_url}/api/v1/snapshots/{language}/download"
        ).json()

# Usage
client = FirecrackerClient()
print(client.health())
result = client.execute("python", "print(1 + 1)")
print(result["stdout"])  # "2\n"
```

## TypeScript/JavaScript SDK Example

```typescript
class FirecrackerClient {
  constructor(private baseUrl = "http://localhost:8080") {}

  async health() {
    const res = await fetch(`${this.baseUrl}/health`);
    return res.json();
  }

  async execute(language: string, code: string, timeout = 30) {
    const res = await fetch(`${this.baseUrl}/api/v1/execute`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ language, code, timeout }),
    });
    return res.json();
  }
}

// Usage
const client = new FirecrackerClient();
const result = await client.execute("nodejs", "console.log(1 + 1)");
console.log(result.stdout); // "2\n"
```

## Taskfile Integration

```bash
# Start API server
task -t Taskfile.cli.yaml api

# Start on custom port
task -t Taskfile.cli.yaml api PORT=3000
```

## OpenAPI/Swagger

The API follows OpenAPI 3.0 conventions. A full OpenAPI specification is available at:

```
GET /openapi.json
```

## Rate Limiting

Currently there is no built-in rate limiting. For production use, consider:

- Nginx/HAProxy rate limiting
- API gateway (Kong, AWS API Gateway)
- Custom middleware

## Next Steps

<CardGroup cols={2}>
  <Card title="CLI Commands" icon="terminal" href="/cli/overview">
    Use the CLI for quick operations
  </Card>
  <Card title="Performance" icon="gauge-high" href="/advanced/performance">
    Optimize API performance
  </Card>
</CardGroup>
