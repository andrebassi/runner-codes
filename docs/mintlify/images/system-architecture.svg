<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1D4ED8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#0f172a" rx="12"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="white" font-family="system-ui" font-size="20" font-weight="600">System Architecture</text>

  <!-- Host OS Container -->
  <rect x="20" y="55" width="860" height="430" rx="12" fill="#1E293B" stroke="#334155" stroke-width="2"/>
  <text x="40" y="80" fill="#94A3B8" font-family="system-ui" font-size="13" font-weight="500">HOST OS (Linux + KVM)</text>

  <!-- infra.operator (host) -->
  <g filter="url(#dropShadow)">
    <rect x="40" y="100" width="180" height="180" rx="10" fill="url(#blueGrad)"/>
    <text x="130" y="135" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">infra.operator host</text>
    <line x1="55" y1="150" x2="205" y2="150" stroke="rgba(255,255,255,0.2)"/>
    <text x="130" y="175" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Firecracker API Client</text>
    <text x="130" y="195" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">VM Lifecycle Manager</text>
    <text x="130" y="215" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Vsock Connector</text>
    <text x="130" y="235" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Job Dispatcher</text>
    <text x="130" y="265" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-family="system-ui" font-size="10">Go Binary</text>
  </g>

  <!-- Arrow to Firecracker -->
  <g>
    <path d="M 230 190 L 280 190" stroke="#64748B" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
    <polygon points="290,190 278,184 278,196" fill="#64748B"/>
    <text x="260" y="175" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">Unix</text>
    <text x="260" y="210" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">Socket</text>
  </g>

  <!-- Firecracker VMM -->
  <g filter="url(#dropShadow)">
    <rect x="300" y="100" width="180" height="180" rx="10" fill="url(#orangeGrad)"/>
    <text x="390" y="135" text-anchor="middle" fill="white" font-family="system-ui" font-size="16" font-weight="600">Firecracker</text>
    <line x1="315" y1="150" x2="465" y2="150" stroke="rgba(255,255,255,0.2)"/>
    <text x="390" y="175" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">REST API Server</text>
    <text x="390" y="195" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">KVM Hypervisor</text>
    <text x="390" y="215" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Vsock Multiplexer</text>
    <text x="390" y="235" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Minimal Device Model</text>
    <text x="390" y="265" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-family="system-ui" font-size="10">Rust Binary (~50k LoC)</text>
  </g>

  <!-- Arrow to VM -->
  <g>
    <path d="M 490 190 L 540 190" stroke="#64748B" stroke-width="2" fill="none"/>
    <polygon points="550,190 538,184 538,196" fill="#64748B"/>
    <text x="520" y="175" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">vsock</text>
    <text x="520" y="210" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">CID=3</text>
  </g>

  <!-- MicroVM Container -->
  <rect x="560" y="70" width="300" height="400" rx="10" fill="#0F172A" stroke="#475569" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="710" y="95" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="13" font-weight="500">Firecracker microVM</text>

  <!-- Guest Kernel -->
  <g filter="url(#dropShadow)">
    <rect x="580" y="110" width="260" height="60" rx="8" fill="url(#purpleGrad)"/>
    <text x="710" y="145" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">Linux Kernel 5.10</text>
  </g>

  <!-- infra.operator (guest) -->
  <g filter="url(#dropShadow)">
    <rect x="580" y="190" width="260" height="140" rx="8" fill="url(#greenGrad)"/>
    <text x="710" y="225" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">infra.operator guest</text>
    <line x1="595" y1="240" x2="825" y2="240" stroke="rgba(255,255,255,0.2)"/>
    <text x="710" y="265" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Vsock Server (port 5000)</text>
    <text x="710" y="285" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Code Executor</text>
    <text x="710" y="305" text-anchor="middle" fill="rgba(255,255,255,0.85)" font-family="system-ui" font-size="11">Python | Node | Go | Rust | Bash</text>
    <text x="710" y="320" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-family="system-ui" font-size="10">Go Binary (Static)</text>
  </g>

  <!-- Rootfs -->
  <g filter="url(#dropShadow)">
    <rect x="580" y="350" width="260" height="100" rx="8" fill="#334155"/>
    <text x="710" y="385" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">Rootfs Image</text>
    <text x="710" y="410" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="11">rootfs-{lang}.ext4</text>
    <text x="710" y="435" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="10">Ubuntu 22.04 + Language Runtime</text>
  </g>

  <!-- S3 Storage -->
  <g filter="url(#dropShadow)">
    <rect x="40" y="320" width="180" height="140" rx="10" fill="#334155"/>
    <text x="130" y="355" text-anchor="middle" fill="white" font-family="system-ui" font-size="16" font-weight="600">AWS S3</text>
    <line x1="55" y1="370" x2="205" y2="370" stroke="rgba(255,255,255,0.15)"/>
    <text x="130" y="395" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="11">vmlinux</text>
    <text x="130" y="415" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="11">rootfs-python.ext4</text>
    <text x="130" y="435" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="11">rootfs-nodejs.ext4</text>
    <text x="130" y="455" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="10">+ go, rust, bash...</text>
  </g>

  <!-- Arrow from S3 -->
  <g>
    <path d="M 230 390 C 280 390, 280 420, 540 420" stroke="#64748B" stroke-width="2" fill="none" stroke-dasharray="4,4"/>
    <polygon points="550,420 538,414 538,426" fill="#64748B"/>
    <text x="380" y="408" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="9">Download on boot</text>
  </g>

  <!-- /dev/kvm label -->
  <rect x="300" y="320" width="180" height="50" rx="8" fill="#1E293B" stroke="#475569"/>
  <text x="390" y="350" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="12">/dev/kvm + /dev/vhost-vsock</text>
</svg>
