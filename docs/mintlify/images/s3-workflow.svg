<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 380">
  <defs>
    <linearGradient id="bgGradS3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fefce8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fef3c7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ec2Grad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="s3GradMain" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="decisionS3" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4f46e5;stop-opacity:1" />
    </linearGradient>
    <filter id="shadowS3" x="-10%" y="-10%" width="120%" height="130%">
      <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowS3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="380" fill="url(#bgGradS3)" rx="12"/>

  <!-- Title -->
  <text x="350" y="28" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="600" fill="#1e293b" text-anchor="middle">S3 Storage Workflow</text>

  <!-- Create Rootfs Section -->
  <rect x="40" y="50" width="200" height="120" rx="8" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="1"/>
  <text x="140" y="70" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#c2410c" text-anchor="middle">Create Rootfs</text>

  <rect x="60" y="85" width="160" height="35" rx="6" fill="url(#ec2Grad)" filter="url(#shadowS3)"/>
  <text x="140" y="100" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">Create rootfs</text>
  <text x="140" y="112" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">on EC2</text>

  <!-- Arrow to decision -->
  <line x1="140" y1="120" x2="140" y2="150" stroke="#64748b" stroke-width="2" marker-end="url(#arrowS3)"/>

  <!-- Decision: Auto-upload? -->
  <polygon points="140,155 190,180 140,205 90,180" fill="url(#decisionS3)" filter="url(#shadowS3)"/>
  <text x="140" y="176" font-family="system-ui, -apple-system, sans-serif" font-size="8" font-weight="500" fill="white" text-anchor="middle">Auto</text>
  <text x="140" y="186" font-family="system-ui, -apple-system, sans-serif" font-size="8" font-weight="500" fill="white" text-anchor="middle">upload?</text>

  <!-- Yes path -->
  <line x1="190" y1="180" x2="270" y2="180" stroke="#10b981" stroke-width="2" marker-end="url(#arrowS3)"/>
  <text x="230" y="172" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#10b981">Yes</text>

  <!-- No path -->
  <line x1="140" y1="205" x2="140" y2="235" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowS3)"/>
  <text x="152" y="220" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#ef4444">No</text>

  <rect x="60" y="240" width="160" height="30" rx="6" fill="url(#ec2Grad)" filter="url(#shadowS3)"/>
  <text x="140" y="260" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">task s3:upload</text>

  <!-- Arrow from manual upload to S3 -->
  <line x1="220" y1="255" x2="280" y2="255" stroke="#64748b" stroke-width="2"/>
  <line x1="280" y1="255" x2="280" y2="180" stroke="#64748b" stroke-width="2"/>

  <!-- S3 Bucket -->
  <rect x="280" y="140" width="140" height="80" rx="8" fill="url(#s3GradMain)" filter="url(#shadowS3)"/>
  <text x="350" y="170" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="white" text-anchor="middle">S3 Bucket</text>
  <text x="350" y="190" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">llm-infra-operator</text>
  <text x="350" y="205" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">-rootfs</text>

  <!-- New EC2 Section -->
  <rect x="460" y="50" width="200" height="120" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1"/>
  <text x="560" y="70" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#1d4ed8" text-anchor="middle">New EC2 Instance</text>

  <rect x="480" y="85" width="160" height="35" rx="6" fill="#3b82f6" filter="url(#shadowS3)"/>
  <text x="560" y="100" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">New EC2</text>
  <text x="560" y="112" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">Instance</text>

  <!-- Arrow EC2 to user-data -->
  <line x1="560" y1="120" x2="560" y2="145" stroke="#64748b" stroke-width="2" marker-end="url(#arrowS3)"/>

  <rect x="480" y="150" width="160" height="30" rx="6" fill="#3b82f6" filter="url(#shadowS3)"/>
  <text x="560" y="170" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">user-data.sh</text>

  <!-- Arrow to Download from S3 -->
  <line x1="480" y1="165" x2="420" y2="165" stroke="#64748b" stroke-width="2" marker-end="url(#arrowS3)"/>

  <!-- Arrow from S3 to Download -->
  <line x1="420" y1="180" x2="480" y2="220" stroke="#10b981" stroke-width="2" marker-end="url(#arrowS3)"/>

  <rect x="480" y="225" width="160" height="30" rx="6" fill="#3b82f6" filter="url(#shadowS3)"/>
  <text x="560" y="245" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">Download from S3</text>

  <!-- Arrow to Ready -->
  <line x1="560" y1="255" x2="560" y2="285" stroke="#64748b" stroke-width="2" marker-end="url(#arrowS3)"/>

  <rect x="480" y="290" width="160" height="35" rx="6" fill="#10b981" filter="url(#shadowS3)"/>
  <text x="560" y="305" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">Ready for</text>
  <text x="560" y="318" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">execution</text>

  <!-- Manual Download Section -->
  <rect x="260" y="260" width="180" height="100" rx="8" fill="rgba(100,116,139,0.1)" stroke="#64748b" stroke-width="1"/>
  <text x="350" y="278" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#475569" text-anchor="middle">Manual Download</text>

  <rect x="280" y="290" width="140" height="30" rx="6" fill="#64748b" filter="url(#shadowS3)"/>
  <text x="350" y="310" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">task s3:download</text>

  <!-- Arrow from S3 to manual download -->
  <line x1="350" y1="220" x2="350" y2="260" stroke="#64748b" stroke-width="2" marker-end="url(#arrowS3)"/>

  <!-- Arrow from manual to EC2 has images -->
  <rect x="280" y="330" width="140" height="25" rx="6" fill="#10b981" filter="url(#shadowS3)"/>
  <text x="350" y="347" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="500" fill="white" text-anchor="middle">EC2 has images</text>
</svg>
