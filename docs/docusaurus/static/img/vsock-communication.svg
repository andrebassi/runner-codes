<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 450">
  <defs>
    <linearGradient id="hostGradV" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1D4ED8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="fcGradV" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="guestGradV" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <filter id="shadowV">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="450" fill="#0f172a" rx="12"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="white" font-family="system-ui" font-size="20" font-weight="600">Vsock Communication Protocol</text>

  <!-- HOST section -->
  <rect x="30" y="60" width="260" height="370" rx="10" fill="#1E293B" stroke="#334155" stroke-width="2"/>
  <text x="160" y="90" text-anchor="middle" fill="white" font-family="system-ui" font-size="16" font-weight="600">HOST</text>

  <!-- infra.operator (host) -->
  <g filter="url(#shadowV)">
    <rect x="50" y="110" width="220" height="80" rx="8" fill="url(#hostGradV)"/>
    <text x="160" y="145" text-anchor="middle" fill="white" font-family="system-ui" font-size="13" font-weight="600">infra.operator host</text>
    <text x="160" y="170" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="system-ui" font-size="11">net.Dial("unix", socket)</text>
  </g>

  <!-- UDS Socket -->
  <g filter="url(#shadowV)">
    <rect x="50" y="220" width="220" height="60" rx="8" fill="#475569"/>
    <text x="160" y="250" text-anchor="middle" fill="white" font-family="system-ui" font-size="12" font-weight="500">/tmp/fc-{id}.vsock</text>
    <text x="160" y="268" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">Unix Domain Socket</text>
  </g>

  <!-- FIRECRACKER section -->
  <rect x="320" y="60" width="260" height="370" rx="10" fill="#1E293B" stroke="#334155" stroke-width="2"/>
  <text x="450" y="90" text-anchor="middle" fill="white" font-family="system-ui" font-size="16" font-weight="600">FIRECRACKER VMM</text>

  <!-- Vsock Device -->
  <g filter="url(#shadowV)">
    <rect x="340" y="140" width="220" height="100" rx="8" fill="url(#fcGradV)"/>
    <text x="450" y="175" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">Vsock Device</text>
    <text x="450" y="200" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="system-ui" font-size="11">Unix Socket ↔ Virtio Queue</text>
    <text x="450" y="220" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="system-ui" font-size="11">/dev/vhost-vsock</text>
  </g>

  <!-- GUEST section -->
  <rect x="610" y="60" width="260" height="370" rx="10" fill="#1E293B" stroke="#334155" stroke-width="2"/>
  <text x="740" y="90" text-anchor="middle" fill="white" font-family="system-ui" font-size="16" font-weight="600">GUEST VM</text>

  <!-- infra.operator (guest) -->
  <g filter="url(#shadowV)">
    <rect x="630" y="110" width="220" height="80" rx="8" fill="url(#guestGradV)"/>
    <text x="740" y="145" text-anchor="middle" fill="white" font-family="system-ui" font-size="13" font-weight="600">infra.operator guest</text>
    <text x="740" y="170" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="system-ui" font-size="11">vsock.Listen(3, 5000)</text>
  </g>

  <!-- Vsock Driver -->
  <g filter="url(#shadowV)">
    <rect x="630" y="220" width="220" height="60" rx="8" fill="#475569"/>
    <text x="740" y="250" text-anchor="middle" fill="white" font-family="system-ui" font-size="12" font-weight="500">/dev/vsock</text>
    <text x="740" y="268" text-anchor="middle" fill="#94A3B8" font-family="system-ui" font-size="10">Virtio-vsock Driver</text>
  </g>

  <!-- Arrows -->
  <!-- Host to FC -->
  <g>
    <line x1="270" y1="150" x2="330" y2="170" stroke="#64748B" stroke-width="2"/>
    <polygon points="340,175 326,165 330,180" fill="#64748B"/>
  </g>
  <g>
    <line x1="270" y1="250" x2="330" y2="220" stroke="#64748B" stroke-width="2"/>
    <polygon points="340,215 326,205 330,220" fill="#64748B"/>
  </g>

  <!-- FC to Guest -->
  <g>
    <line x1="570" y1="170" x2="620" y2="150" stroke="#64748B" stroke-width="2"/>
    <polygon points="630,145 616,140 620,155" fill="#64748B"/>
  </g>
  <g>
    <line x1="570" y1="220" x2="620" y2="250" stroke="#64748B" stroke-width="2"/>
    <polygon points="630,255 616,250 620,265" fill="#64748B"/>
  </g>

  <!-- Protocol steps -->
  <rect x="50" y="310" width="800" height="110" rx="8" fill="#0F172A" stroke="#334155"/>
  <text x="450" y="340" text-anchor="middle" fill="white" font-family="system-ui" font-size="14" font-weight="600">Handshake Protocol</text>

  <!-- Step boxes -->
  <rect x="70" y="355" width="170" height="50" rx="6" fill="#1E293B"/>
  <text x="155" y="375" text-anchor="middle" fill="#3B82F6" font-family="monospace" font-size="11">CONNECT 5000\n</text>
  <text x="155" y="395" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="10">Host → FC</text>

  <text x="270" y="382" text-anchor="middle" fill="#475569" font-family="system-ui" font-size="18">→</text>

  <rect x="300" y="355" width="170" height="50" rx="6" fill="#1E293B"/>
  <text x="385" y="375" text-anchor="middle" fill="#F97316" font-family="system-ui" font-size="11">Route to Guest</text>
  <text x="385" y="395" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="10">FC multiplexes</text>

  <text x="500" y="382" text-anchor="middle" fill="#475569" font-family="system-ui" font-size="18">→</text>

  <rect x="530" y="355" width="170" height="50" rx="6" fill="#1E293B"/>
  <text x="615" y="375" text-anchor="middle" fill="#10B981" font-family="monospace" font-size="11">OK 5000\n</text>
  <text x="615" y="395" text-anchor="middle" fill="#64748B" font-family="system-ui" font-size="10">Guest accepts</text>

  <text x="730" y="382" text-anchor="middle" fill="#475569" font-family="system-ui" font-size="18">→</text>

  <rect x="760" y="355" width="70" height="50" rx="6" fill="#10B981"/>
  <text x="795" y="385" text-anchor="middle" fill="white" font-family="system-ui" font-size="11" font-weight="600">Ready!</text>
</svg>
